import Head from 'next/head'
import Image from 'next/image'
import 'bootstrap/dist/css/bootstrap.css'
import styles from '../../styles/vent/quiz.module.scss'
import Link from "next/link";
import VentInto from '../../components/ventinto'
import { useState, useEffect } from 'react';
import { useRouter } from 'next/router'

import Lottie from 'react-lottie';
import animationData from '../../lottiefiles/checkmark.json';

export default function Instruction() {
  const router = useRouter()
  const [dataSelector, setDataSelector] = useState({
    mode : '',
    triggering_variable : '',
    control_pressure_variable : '',
    cycling_variable : '',
  });
  const [modeCurrent, setModeCurrent] = useState('Pressure Control');
  const [showLottie, setShowLottie] = useState(false);


  var ansMode1 = {
    mode : 'Pressure Control',
    triggering_variable : 'Machine',
    control_pressure_variable : 'Pressure',
    cycling_variable : 'Time',
  }

  var ansMode2 = {
    mode : 'Volume Control',
    triggering_variable : 'Machine',
    control_pressure_variable : 'Flow',
    cycling_variable : 'Volume',
  }

  var ansMode3 = {
    mode : 'Volume Control',
    triggering_variable : 'Patient',
    control_pressure_variable : 'Flow',
    cycling_variable : 'Volume',
  }

  var ansMode4 = {
    mode : 'Pressure Support',
    triggering_variable : 'Patient',
    control_pressure_variable : 'Pressure',
    cycling_variable : 'Flow',
  }

  // lottie
  const lottieOptions = {
    animationData: animationData,
    // loop: true,
    loop: false,
    autoplay: true,
    rendererSettings: {
      // preserveAspectRatio: 'xMidYMid slice'
      preserveAspectRatio: 'none'
    }
  };
  
  const handleSettingbtn = (event) => {

      const btnName = event.currentTarget.getAttribute('data-btnName');
      const btnStep = event.currentTarget.getAttribute('data-step');
      console.log(btnName);

      // Remove Active class All
      const btnOtherAll = document.querySelectorAll(`[data-step=${btnStep}]`);
      btnOtherAll.forEach((element) => {
        element.classList.remove(styles['btnActive']);
      });
      // Add Active class
      event.currentTarget.classList.add(styles['btnActive']);

      // Set data
      dataSelector[btnStep] = btnName;
      setDataSelector(dataSelector)

      console.log(dataSelector)
  }

  const handleSubmit = () => {
      console.log('Submit');

      // const dataMode = dataSelector.mode
      // const triggering_variable = dataSelector.triggering_variable
      // const control_pressure_variable = dataSelector.control_pressure_variable
      // const cycling_variable = dataSelector.cycling_variable


      if (JSON.stringify(dataSelector) === JSON.stringify(ansMode1) || JSON.stringify(dataSelector) === JSON.stringify(ansMode2) || JSON.stringify(dataSelector) === JSON.stringify(ansMode3) || JSON.stringify(dataSelector) === JSON.stringify(ansMode4)) {
        console.log('ถูก')

        setShowLottie(true)
        
        if (modeCurrent == 'Pressure Control') {
          setModeCurrent('Volume Control')
        } else if (modeCurrent == 'Volume Control') {
          setModeCurrent('Pressure Support')
        }

        const mainWrap = document.querySelector('#main')
        mainWrap.classList.add(styles['hidden']);
        mainWrap.classList.remove(styles['flade']);
        setTimeout(() => { 
          mainWrap.classList.remove(styles['hidden']);
          mainWrap.classList.add(styles['flade']);

          setShowLottie(false)
         }, 2000)

        const btnAll = document.querySelectorAll(`.${styles.btnSelect}`);
        btnAll.forEach((element) => {
          element.classList.remove(styles['btnActive']);
        });

      } else {
        console.log('ผิด')
        router.push('/hint/brain-false')
      }
  }

  return (
    <div className={styles.container}>
      <Head>
        <title>Instruction </title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <div className='prev_page'>
          <Link href="/menulearningmode"> 
            <Image
                src="/images/prev.png"
                alt="Women"
                width={196}
                height={196}
            />
            </Link>
      </div>{/* prev_page */}
      <div className='container'>
          {showLottie &&
          <div className={styles.lottieCheck}>
            <Lottie options={lottieOptions} />
          </div>
          }    


        <div id='main' className='row g-5 py-2 pt-lg-5'>         
          <div className='col-12 mb-3'>

            <div className={styles.quiz_title}>
              เลือกเงื่อนไขในการตั้งค่าสำหรับสำหรับโหมด 
              <strong>
                {modeCurrent.includes("Pressure Control") && 'Pressure Control'} {modeCurrent.includes("Volume Control") && 'Volume Control'} {modeCurrent.includes("Pressure Support") && 'Pressure Support'}
              </strong>            
            </div>
          </div>
          <div className='col-12 col-md-6 col-lg-3 master-col'>
            <div className={styles.title_col}>
              Mode
            </div>
            {modeCurrent.includes("Pressure Control") &&
            <button className={styles.btnSelect} data-btnName='Pressure Control' data-step='mode' onClick={handleSettingbtn}>
              Pressure<br/>
              Control
            </button>
            }
            {modeCurrent.includes("Volume Control") &&
            <button className={styles.btnSelect} data-btnName='Volume Control' data-step='mode' onClick={handleSettingbtn}>
              Volume<br/>
              Control
            </button>
            }
            {modeCurrent.includes("Pressure Support") &&            
            <button className={styles.btnSelect} data-btnName='Pressure Support' data-step='mode' onClick={handleSettingbtn}>
              Pressure<br/>
              Support
            </button>
            }
          </div>

          <div className='col-12 col-md-6 col-lg-3 master-col'>
            <div className={styles.title_col}>
              Triggering <br/>
              variable
            </div>
            <button className={styles.btnSelect} data-btnName='Machine' data-step='triggering_variable' onClick={handleSettingbtn}>
              Machine
            </button>
            <button className={styles.btnSelect} data-btnName='Patient' data-step='triggering_variable' onClick={handleSettingbtn}>
              Patient
            </button>
          </div>

          <div className='col-12 col-md-6 col-lg-3 master-col'>
            <div className={styles.title_col}>
              Control of <br/>
              pressure variable
            </div>
            <button className={styles.btnSelect} data-btnName='Flow' data-step='control_pressure_variable' onClick={handleSettingbtn}>
              Flow
            </button>
            <button className={styles.btnSelect} data-btnName='Pressure' data-step='control_pressure_variable' onClick={handleSettingbtn}>
              Pressure
            </button>
          </div>

          <div className='col-12 col-md-6 col-lg-3 master-col'>
            <div className={styles.title_col}>
              Cycling off <br/>
              variable
            </div>
            <button className={styles.btnSelect} data-btnName='Time' data-step='cycling_variable' onClick={handleSettingbtn}>
              Time
            </button>
            <button className={styles.btnSelect} data-btnName='Volume' data-step='cycling_variable' onClick={handleSettingbtn}>
              Volume
            </button>
            <button className={styles.btnSelect} data-btnName='Flow' data-step='cycling_variable' onClick={handleSettingbtn}>
              Flow
            </button>
          </div>


          <div className='col-12 text-end'>
            <button className={styles.btnSubmit} onClick={handleSubmit}>
                SUBMIT
            </button>
          </div>
        </div>
      </div>
    </div>
  )
}